<?xml version="1.0" encoding="UTF-8"?>
<api context="/sageToQuickbase" name="SageToQuickbase_API" xmlns="http://ws.apache.org/ns/synapse">
    <resource methods="GET" url-mapping="/AccessBuild">
        <inSequence>
            <call>
                <endpoint key="GetSageDatabase"/>
            </call>
            <enrich>
                <source clone="false" xpath="json-eval($.results.result[?(@.access_QuickBaseRecordID==null)].access_QuickBaseRecordID,$.results.result[?(@.access_Site_Latitude==null)].access_Site_Latitude,$.results.result[?(@.access_Site_Longitude==null)].access_Site_Longitude,$.results.result[?(@.access_DFABuildingNr==null)].access_DFABuildingNr,$.results.result[?(@.Ownership==null)].Ownership,$.results.result[?(@.Build_Company==null)].Build_Company,$.results.result[?(@.access_Site_Address==null)].access_Site_Address,$.results.result[?(@.access_dfaregion==null)].access_dfaregion,$.results.result[?(@.access_infrastructureid==null)].access_infrastructureid)"/>
                <target action="remove" type="body"/>
            </enrich>
            <foreach expression="json-eval($.results.result)" id="foreach_1">
                <sequence>
                    <payloadFactory description="Data mapping" media-type="json">
                        <format>{
                            "3" :{"value":"$1"},
				            "6" :{"value":"$2"},
				            "7" :{"value":"$3"},
				            "68":{"value":"$4"},
				            "92":{"value":"$5"},
				            "93":{"value":"$6"},
				            "153":{"value":"$7"},
				            "154":{"value":"$8"},
				            "282":{"value":"$9"},
				            "348":{"value":"$10"},
				            "479":{"value":"$11"},
				            "524": {"value":"$12"}
				   }</format>
                        <args>
                            <arg evaluator="json" expression="$.access_QuickBaseRecordID"/>
                            <arg evaluator="json" expression="$.Access_ID"/>
                            <arg evaluator="json" expression="$.access_DFABuildingNr"/>
                            <arg evaluator="json" expression="$.access_Site_Name"/>
                            <arg evaluator="json" expression="$.access_Site_Latitude"/>
                            <arg evaluator="json" expression="$.access_Site_Longitude"/>
                            <arg evaluator="json" expression="$.Ownership"/>
                            <arg evaluator="json" expression="$.Build_Company"/>
                            <arg evaluator="json" expression="$.access_Site_Address"/>
                            <arg evaluator="json" expression="$.access_dfaregion"/>
                            <arg evaluator="json" expression="$.access_infrastructureid"/>
                            <arg evaluator="json" expression="$.Comp_IdCust"/>
                        </args>
                    </payloadFactory>
                </sequence>
            </foreach>
            <enrich>
                <source clone="false" xpath="json-eval($.results.result[?(@.3.value=='')].3,$.results.result[?(@.92.value=='')].92,$.results.result[?(@.93.value=='')].93,$.results.result[?(@.7.value=='')].7,$.results.result[?(@.153.value=='')].153,$.results.result[?(@.154.value=='')].154,$.results.result[?(@.282.value=='')].282,$.results.result[?(@.348.value=='')].348,$.results.result[?(@.479.value=='')].479)"/>
                <target action="remove" type="body"/>
            </enrich>
            <enrich>
                <source clone="false" xpath="json-eval($.results.result)"/>
                <target type="body"/>
            </enrich>
            <payloadFactory description="Data mapping" media-type="json">
                <format>{
                        	"to":"bs32tiwqq",
                            "data" :$1,
                            "fieldsToReturn":[
                            	5
                            ]
				            
				   }</format>
                <args>
                    <arg evaluator="json" expression="$"/>
                </args>
            </payloadFactory>
            <!--
            <enrich>
                <source clone="false" xpath="json-eval($.results.result)"/>
                <target type="body"/>
            </enrich> -->
            <respond/>
        </inSequence>
        <outSequence/>
        <faultSequence/>
    </resource>
</api>
